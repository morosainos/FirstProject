@echo off 
 
SET server=localhost 
SET database=OTP 
SET port=5432 
SET username=postgres 
 
for /f "delims=" %%a in ('chcp ^|find /c "932"') do @ SET CLIENTENCODING_JP=%%a 
if "%CLIENTENCODING_JP%"=="1" SET PGCLIENTENCODING=SJIS 
if "%CLIENTENCODING_JP%"=="1" SET /P PGCLIENTENCODING="Client Encoding [%PGCLIENTENCODING%]: " 
 
REM Run psql 
echo "Drop database" 
"C:\Program Files\PostgreSQL\9.4\bin\dropdb.exe" -h %server% -p %port% -U %username% -i -e %database% 
 
echo "Create database" 
"C:\Program Files\PostgreSQL\9.4\bin\createdb.exe" -h %server% -p %port% -U %username% -E "UTF8" -e %database% 
 
echo "Call Flyway Migrate For UI Schema" 
::Repair only used for repair old version file in local development 
call gradle flywayRepair 
call gradle flywayMigrate 
 
cd/d "%~dp0" 
set TARGET_PARTH=%cd:\=/%/ 
echo %TARGET_PARTH% 
echo "insert table translations" 
sed -e s#RESOURCE_PATH#'%TARGET_PARTH%'#g sql\\translations\\add_translations.sql > sql\\translations\\add_translations.tmp.sql 
"C:\Program Files\PostgreSQL\9.4\bin\psql.exe" -h %server% -U %username% -d %database% -p %port% -a -f sql\\translations\\add_translations.tmp.sql 
 
echo Delete temp file 
del /f sql\\translations\\add_translations.tmp.sql 
  